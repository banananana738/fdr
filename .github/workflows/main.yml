name: RustDesk Remote

on: workflow_dispatch

jobs:
  rustdesk:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    
    steps:
    - name: Install RustDesk
      run: |
        echo "Installing RustDesk..."
        
        # Download latest RustDesk
        wget https://github.com/rustdesk/rustdesk/releases/download/1.2.3/rustdesk-1.2.3-x86_64.deb
        
        # Install
        sudo apt install -y ./rustdesk-1.2.3-x86_64.deb
        
        # Or install via package manager
        # sudo apt install -y rustdesk
        
    - name: Start RustDesk with Password
      run: |
        echo "Starting RustDesk..."
        
        # Create a simple password (change if you want)
        PASSWORD="github123"
        
        # Start RustDesk in background
        rustdesk --password $PASSWORD &
        
        # Get ID
        sleep 5
        RUSTDESK_ID=$(rustdesk --get-id)
        
        echo "RUSTDESK_ID=$RUSTDESK_ID" >> $GITHUB_ENV
        echo "RUSTDESK_PASSWORD=$PASSWORD" >> $GITHUB_ENV
        
        echo "‚úÖ RustDesk started!"
        
    - name: Show Connection QR Code
      run: |
        echo ""
        echo "=========================================="
        echo "        RUSTDESK REMOTE ACCESS           "
        echo "=========================================="
        echo ""
        echo "üåê ID: ${{ env.RUSTDESK_ID }}"
        echo "üîê Password: ${{ env.RUSTDESK_PASSWORD }}"
        echo ""
        echo "üì± Connect using:"
        echo ""
        echo "Method 1 - Desktop:"
        echo "1. Install RustDesk from rustdesk.com"
        echo "2. Enter ID: ${{ env.RUSTDESK_ID }}"
        echo "3. Click Connect"
        echo ""
        echo "Method 2 - Web (Beta):"
        echo "1. Go to: https://web.rustdesk.com"
        echo "2. Enter ID and password"
        echo ""
        echo "Method 3 - QR Code:"
        echo "1. Generate QR at:"
        echo "   https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=rustdesk://${{ env.RUSTDESK_ID }}?password=${{ env.RUSTDESK_PASSWORD }}"
        echo ""
        echo "‚è±Ô∏è  Available: 6 hours"
        echo "üíª OS: Ubuntu Linux"
        echo "=========================================="
        
    - name: Install Tools (Optional)
      run: |
        echo "Installing useful tools..."
        
        # Update system
        sudo apt update
        
        # Install basic tools
        sudo apt install -y \
          git curl wget nano htop \
          python3 python3-pip nodejs npm \
          neofetch
        
        echo "‚úÖ Tools installed"
        
    - name: Keep Alive
      run: |
        # Keep running for 6 hours
        echo "RustDesk session active..."
        echo "ID: ${{ env.RUSTDESK_ID }}"
        
        # Show countdown
        for hour in {1..6}; do
          for minute in {1..60}; do
            total_minutes=$(( (hour-1)*60 + minute ))
            remaining=$(( 360 - total_minutes ))
            
            if (( total_minutes % 30 == 0 )); then
              echo "[$(date '+%H:%M:%S')] $remaining minutes left | ID: ${{ env.RUSTDESK_ID }}"
            fi
            
            sleep 60
          done
        done
